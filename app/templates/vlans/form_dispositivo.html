{% extends 'base.html' %}
{% from '_form_helpers.html' import render_field, render_select, render_textarea, render_ajax_select %}
{% block title %}{{ titulo }}{% endblock %}
{% block header_title %}{{ titulo }}{% endblock %}
{% block content %}
<form method="post" novalidate class="needs-validation">
  {{ form.hidden_tag() }}
  <div class="form-section">
    <div class="section-header">Datos del dispositivo</div>
    <div class="section-body row g-3">
      {{ render_field(form.nombre_equipo, form_group_class='col-12 col-md-6', placeholder='Nombre de referencia') }}
      {{ render_field(form.host, form_group_class='col-12 col-md-6', placeholder='Hostname en la red') }}
      {{ render_field(form.direccion_ip, form_group_class='col-12 col-md-6', placeholder='Ej: 10.0.0.25') }}
      {{ render_field(form.direccion_mac, form_group_class='col-12 col-md-6', placeholder='AA:BB:CC:DD:EE:FF') }}
      {{ render_textarea(form.notas, form_group_class='col-12', rows=3, placeholder='Notas adicionales o ubicación física') }}
    </div>
  </div>
  <div class="form-section">
    <div class="section-header">Asignación</div>
    <div class="section-body row g-3">
      {{ render_ajax_select(
        form.hospital_id,
        url_for('api.search_hospitales'),
        form_group_class='col-12 col-md-6',
        placeholder='Escriba para buscar un hospital'
      ) }}
      {{ render_ajax_select(
        form.servicio_id,
        url_for('api.search_servicios'),
        form_group_class='col-12 col-md-6',
        placeholder='Sin servicio asignado',
        depends_on=form.hospital_id.id,
        depends_message='Seleccione un hospital para filtrar servicios',
        dependency_param='hospital_id',
        allow_clear=True
      ) }}
      {{ render_ajax_select(
        form.oficina_id,
        url_for('api.search_oficinas'),
        form_group_class='col-12 col-md-6',
        placeholder='Sin oficina asignada',
        depends_on=form.servicio_id.id,
        depends_message='Seleccione un servicio para filtrar oficinas',
        dependency_param='servicio_id',
        extra_params=[{'field': form.hospital_id.id, 'param': 'hospital_id'}],
        allow_clear=True
      ) }}
      {{ render_select(form.vlan_id, form_group_class='col-12 col-md-6') }}
    </div>
  </div>
  <div class="d-flex flex-column flex-md-row gap-2 justify-content-end">
    {{ form.submit(class='btn btn-primary px-4') }}
    {% if vlan %}
    <a class="btn btn-outline-secondary" href="{{ url_for('vlans.detalle', vlan_id=vlan.id) }}">Cancelar</a>
    {% else %}
    <a class="btn btn-outline-secondary" href="{{ url_for('vlans.listar') }}">Cancelar</a>
    {% endif %}
  </div>
</form>
{% endblock %}
