{% extends 'base.html' %}
{% from '_pagination.html' import render_pagination %}
{% block title %}Ubicaciones{% endblock %}
{% block content %}
<div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-3">
  <h1 class="h3 mb-0">Hospitales</h1>
  <div class="d-flex flex-column flex-sm-row gap-2">
    <form class="d-flex gap-2" method="get">
      <input class="form-control" type="search" name="q" value="{{ buscar }}" placeholder="Buscar hospital" />
      <button class="btn btn-outline-primary" type="submit">Buscar</button>
    </form>
    <div class="btn-group">
      <a class="btn btn-primary" href="{{ url_for('ubicaciones.crear_hospital') }}">Nuevo hospital</a>
      <a class="btn btn-outline-primary" href="{{ url_for('ubicaciones.crear_servicio') }}">Nuevo servicio</a>
      <a class="btn btn-outline-primary" href="{{ url_for('ubicaciones.crear_oficina') }}">Nueva oficina</a>
    </div>
  </div>
</div>
<div class="accordion" id="hospitalAccordion">
  {% for hospital in hospitales %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading{{ hospital.id }}">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ hospital.id }}" aria-expanded="false" aria-controls="collapse{{ hospital.id }}">
        {{ hospital.nombre }}
      </button>
    </h2>
    <div id="collapse{{ hospital.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ hospital.id }}" data-bs-parent="#hospitalAccordion">
      <div class="accordion-body">
        <p><a class="btn btn-sm btn-outline-secondary" href="{{ url_for('ubicaciones.editar_hospital', hospital_id=hospital.id) }}">Editar hospital</a></p>
        <ul class="list-group">
          {% for servicio in hospital.servicios %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ servicio.nombre }}</strong> {% if servicio.descripcion %}<small class="text-muted">{{ servicio.descripcion }}</small>{% endif %}
              </div>
              <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('ubicaciones.editar_servicio', servicio_id=servicio.id) }}">Editar</a>
            </div>
            {% if servicio.oficinas %}
            <ul class="mt-2 ps-3">
              {% for oficina in servicio.oficinas %}
              <li>
                {{ oficina.nombre }} {% if oficina.piso %}(Piso {{ oficina.piso }}){% endif %}
                <a class="btn btn-sm btn-link" href="{{ url_for('ubicaciones.editar_oficina', oficina_id=oficina.id) }}">Editar</a>
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <p class="text-muted mb-0 mt-2">Sin oficinas registradas.</p>
            {% endif %}
          </li>
          {% else %}
          <li class="list-group-item text-muted">Sin servicios registrados.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  {% else %}
  <p class="text-muted">Sin hospitales registrados.</p>
  {% endfor %}
</div>
{{ render_pagination(pagination) }}
{% endblock %}
