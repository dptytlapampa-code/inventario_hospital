{% extends 'base.html' %}
{% from '_form_helpers.html' import render_field, render_checkbox, render_textarea %}
{% block title %}Tipos de equipo{% endblock %}
{% block header_title %}Tipos de equipo{% endblock %}
{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-4">
  <div>
    <h1 class="h3 mb-0">Catálogo de tipos de equipo</h1>
    <p class="text-muted mb-0">Defina las categorías disponibles para asignar a cada equipo. Solo los tipos activos pueden seleccionarse al crear un nuevo equipo.</p>
  </div>
</div>
<div class="row g-3">
  <div class="col-12 col-lg-5">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light fw-semibold">Agregar nuevo tipo</div>
      <div class="card-body">
        <form method="post" novalidate>
          {{ create_form.hidden_tag() }}
          {{ render_field(create_form.nombre, form_group_class='mb-3', label_class='form-label fw-semibold', input_class='form-control', placeholder='Nombre del tipo (p. ej. Notebook)') }}
          {{ render_textarea(create_form.descripcion, form_group_class='mb-3', label_class='form-label fw-semibold', rows=3, placeholder='Descripción u observaciones (opcional)') }}
          {{ render_checkbox(create_form.activo, form_group_class='form-check form-switch mb-3', input_class='form-check-input', label_class='form-check-label fw-semibold') }}
          <div class="d-flex justify-content-end">
            {{ create_form.submit(class='btn btn-primary') }}
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-7">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light fw-semibold d-flex justify-content-between align-items-center">
        <span>Tipos existentes</span>
        <span class="badge bg-secondary">{{ tipos|length }}</span>
      </div>
      <div class="card-body p-0">
        {% if tipos %}
        <div class="list-group list-group-flush">
          {% for tipo, form, delete_form, has_equipos in update_forms %}
          <div class="list-group-item list-group-item-action py-3">
            <form method="post" action="{{ url_for('equipos.actualizar_tipo', tipo_id=tipo.id) }}" class="d-flex flex-column flex-lg-row gap-3 align-items-start" novalidate>
              {{ form.hidden_tag() }}
              <div class="flex-fill">
                <label class="form-label small text-muted mb-1" for="{{ form.nombre.id }}">Nombre</label>
                {{ render_field(form.nombre, form_group_class='mb-2', label_class='visually-hidden', input_class='form-control form-control-sm', extra_attrs={'aria-describedby': 'tipo-ayuda-' ~ tipo.id}) }}
                <div id="tipo-ayuda-{{ tipo.id }}" class="form-text mb-2">Se muestra como “{{ tipo.nombre }}” en los listados.</div>
                {{ render_textarea(form.descripcion, form_group_class='mb-2', label_class='form-label small text-muted', rows=3, placeholder='Descripción (opcional)') }}
              </div>
              {{ render_checkbox(form.activo, form_group_class='form-check form-switch mb-0 mt-1 align-self-stretch', input_class='form-check-input', label_class='form-check-label fw-semibold') }}
              <div class="text-lg-end ms-lg-auto d-flex flex-column gap-2 w-100 w-lg-auto">
                {% if not tipo.activo %}
                <span class="badge bg-secondary">Inactivo</span>
                {% else %}
                <span class="badge bg-success">Activo</span>
                {% endif %}
                {{ form.submit(class='btn btn-outline-primary btn-sm w-100 w-lg-auto') }}
              </div>
            </form>
            <form method="post" action="{{ url_for('equipos.eliminar_tipo', tipo_id=tipo.id) }}" class="mt-3 text-end" onsubmit="return confirm('¿Eliminar el tipo de equipo? Esta acción no se puede deshacer.');">
              {{ delete_form.hidden_tag() }}
              <button type="submit" class="btn btn-outline-danger btn-sm" {% if has_equipos %}disabled data-bs-toggle="tooltip" data-bs-placement="top" title="No se puede eliminar porque hay equipos asociados"{% endif %}>Eliminar</button>
            </form>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="p-4 text-center text-muted">Todavía no hay tipos registrados.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
