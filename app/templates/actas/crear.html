{% extends "base.html" %}
{% from '_form_helpers.html' import render_select, render_textarea, render_ajax_select, render_equipo_selector %}
{% block title %}Generar acta{% endblock %}
{% block header_title %}Generar acta{% endblock %}
{% block content %}
<form method="post" novalidate class="needs-validation">
  {{ form.hidden_tag() }}
  <div class="form-section">
    <div class="section-header">Datos principales</div>
    <div class="section-body row g-3">
      {{ render_select(form.tipo, form_group_class='col-12 col-md-4') }}
      {{ render_select(form.hospital_id, form_group_class='col-12 col-md-4') }}
      {{ render_ajax_select(
        form.servicio_id,
        url_for('api.search_servicios'),
        form_group_class='col-12 col-md-4',
        placeholder='Escriba para buscar un servicio'
      ) }}
      {{ render_ajax_select(
        form.oficina_id,
        url_for('api.search_oficinas'),
        form_group_class='col-12 col-md-4',
        placeholder='Filtre oficinas por servicio',
        depends_on=form.servicio_id.id,
        depends_message='Seleccione un servicio para filtrar oficinas'
      ) }}
    </div>
  </div>
  <div class="form-section">
    <div class="section-header">Equipos y observaciones</div>
    <div class="section-body row g-3">
      {{ render_equipo_selector(
        form.equipos,
        form_group_class='col-12',
        label='Equipos',
        placeholder='Busque equipos por tipo, marca o serieâ€¦',
        multiple=True,
        allow_clear=True,
        initial_options=equipos_options or []
      ) }}
      {{ render_textarea(form.observaciones, form_group_class='col-12', rows=3, placeholder='Observaciones adicionales') }}
    </div>
  </div>
  <div class="d-flex flex-column flex-md-row gap-2 justify-content-end">
    {{ form.submit(class="btn btn-primary px-4") }}
    <a class="btn btn-outline-secondary" href="{{ url_for('actas.listar') }}">Cancelar</a>
  </div>
</form>
{% endblock %}
