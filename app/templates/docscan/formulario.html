{% extends 'base.html' %}
{% from '_form_helpers.html' import render_field, render_select, render_textarea, render_ajax_select %}
{% block title %}{{ titulo }}{% endblock %}
{% block content %}
<h1 class="h3 mb-4">{{ titulo }}</h1>
<form method="post" enctype="multipart/form-data" novalidate>
  {{ form.hidden_tag() }}
  <div class="row g-3">
    {{ render_field(form.titulo, form_group_class='col-md-6') }}
    {{ render_select(form.tipo, form_group_class='col-md-3') }}
    {{ render_field(form.fecha_documento, form_group_class='col-md-3', input_class='form-control', input_type='text') }}
    {{ render_ajax_select(
      form.hospital_id,
      url_for('api.search_hospitales'),
      form_group_class='col-md-4',
      placeholder='Escriba para buscar un hospital',
      allow_clear=True
    ) }}
    {{ render_ajax_select(
      form.servicio_id,
      url_for('api.search_servicios'),
      form_group_class='col-md-4',
      placeholder='Escriba para buscar un servicio',
      depends_on=form.hospital_id.id,
      depends_message='Seleccione un hospital para filtrar servicios',
      dependency_param='hospital_id',
      allow_clear=True
    ) }}
    {{ render_ajax_select(
      form.oficina_id,
      url_for('api.search_oficinas'),
      form_group_class='col-md-4',
      placeholder='Filtre oficinas por servicio',
      depends_on=form.servicio_id.id,
      depends_message='Seleccione un servicio para filtrar oficinas',
      dependency_param='servicio_id',
      extra_params=[{'field': form.hospital_id.id, 'param': 'hospital_id'}],
      allow_clear=True
    ) }}
    {{ render_textarea(form.comentario, form_group_class='col-12', rows=3) }}
    {{ render_field(form.archivo, form_group_class='col-12', input_class='form-control') }}
  </div>
  <div class="mt-4 d-flex gap-2">
    {{ form.submit(class='btn btn-primary') }}
    <a class="btn btn-outline-secondary" href="{{ url_for('docscan.listar') }}">Cancelar</a>
  </div>
</form>
{% endblock %}
