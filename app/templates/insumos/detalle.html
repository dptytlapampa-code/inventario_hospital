{% extends 'base.html' %}
{% from '_form_helpers.html' import render_field, render_select, render_textarea %}
{% block title %}Detalle de insumo{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">{{ insumo.nombre }}</h1>
  <a class="btn btn-outline-secondary" href="{{ url_for('insumos.listar') }}">Volver</a>
</div>
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="text-muted">Stock actual</h6>
        <p class="mb-0 fs-4">{{ insumo.stock }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="text-muted">Stock mínimo</h6>
        <p class="mb-0 fs-5">{{ insumo.stock_minimo }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="text-muted">Número de serie</h6>
        <p class="mb-0">{{ insumo.numero_serie or '—' }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="text-muted">Costo unitario</h6>
        <p class="mb-0">
          {% if insumo.costo_unitario is not none %}
            $ {{ '%.2f'|format(insumo.costo_unitario) }}
          {% else %}
            —
          {% endif %}
        </p>
      </div>
    </div>
  </div>
</div>
<div class="row g-3">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header">Registrar movimiento</div>
      <div class="card-body">
        <form method="post" action="{{ url_for('insumos.registrar_movimiento', insumo_id=insumo.id) }}" novalidate>
          {{ movimiento_form.hidden_tag() }}
          {{ render_select(movimiento_form.tipo) }}
          {{ render_field(movimiento_form.cantidad, input_class='form-control', min_value=1) }}
          {{ render_select(movimiento_form.equipo_id) }}
          {{ render_field(movimiento_form.motivo) }}
          {{ render_textarea(movimiento_form.observaciones, rows=3) }}
          {{ movimiento_form.submit(class="btn btn-primary") }}
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header">Movimientos recientes</div>
      <ul class="list-group list-group-flush">
        {% for movimiento in movimientos %}
        <li class="list-group-item">
          <strong class="text-capitalize">{{ movimiento.tipo.value }}</strong>
          ({{ movimiento.cantidad }})
          {% if movimiento.equipo %}- {{ movimiento.equipo.descripcion or movimiento.equipo.codigo }}{% endif %}<br>
          <small class="text-muted">{{ movimiento.fecha }}{% if movimiento.usuario %} por {{ movimiento.usuario.nombre }}{% endif %}</small>
          {% if movimiento.motivo %}<br>{{ movimiento.motivo }}{% endif %}
        </li>
        {% else %}
        <li class="list-group-item text-muted">No hay movimientos registrados.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}
